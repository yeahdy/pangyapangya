<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<html>
<head>
    <title>원데이클래스 | 상세보기</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="icon" type="image/png"  href="/images/favicon.png"/>
    <style>
        .headerIcon{
            width: 40px;
            display: block;
            margin: auto;"
        }
        .icon.solid:before {
            font-weight: 100;
            content: none;
        }

        .spotlights h5{
            font-weight: bold;
            font-size: small;
        }

        .spotlights p{
            font-size: small;
        }

        /* 검색창 */
        .search {
            position: relative;
            text-align: center;
            width: 400px;
            margin: 0 auto;
        }
        input {
            width: 100%;
            border-radius: 20px;
            border: 1px solid #bbb;
            margin: 10px 0;
            padding: 10px 12px;
        }
        .fa-search {
            position: absolute;
            left: 90%;
            top: 35%;
            margin: 0;
        }
        form {
            margin: 0;
        }

        /* 탭 */
        p {
            margin: 0 0 20px;
            line-height: 1.5;}

        .main1 {
            min-width: 320px;
            max-width: 800px;
            padding: 0px 30px 30px 30px;
            margin: 0 auto;
            background: #ffffff;}

        section #content1{
            display: none;
            padding: 20px 0 0;
            border-top: 1px solid #ddd;}

        section #content2{
            display: none;
            padding: 20px 0 0;
            border-top: 1px solid #ddd;}

        /*라디오버튼 숨김*/

        input[type="radio" i] {
            display: none;
        }

        label {
            display: inline-block;
            margin: 0 0 -1px;
            padding: 15px 25px;
            font-weight: 600;
            text-align: center;
            color: #bbb;
            border: 1px solid transparent;}

        label:hover {
            color: #2e9cdf;
            cursor: pointer;}

        input[type="radio"]:checked + label:before {
            background-color: #F9A825;
            border-color: #F9A825;
            color: #fff;
            display: none;
        }
        input[type="radio"] + label:before {
            border-radius: 100%;
            display: none;
        }

        input[type="radio"] + label {
            text-decoration: none;
            cursor: pointer;
            display: inline-block;
            font-size: 1em;
            font-weight: 400;
            padding-left: 2.4em;
            padding-right: 2.4em;
            position: relative;
        }
        /*input 클릭시, label 스타일*/
        input:checked + label {
            color: #555;
            border: 0px solid #ddd;
            border-bottom: 3px solid #2e9cdf;
            border-top: 1px solid #ffffff;}

        #tab1:checked ~ #content1,
        #tab2:checked ~ #content2{
            display: block;}

        h2{
            text-align: center;
        }

        /* 신청하기 버튼 가운데 정렬 */
        ul.actions{
            justify-content: center;
        }

        #apply{
            border: 1px;
            width: 300px;
        }

        .summary{
            margin: 2em 2em 2em 2em;
            border: 1px;
        }

        #save{
            border-radius: 20px;
            margin: 10px;
        }

        /* 별점 */
        #star a{ text-decoration: none; color: gray; } #star a.on{ color: orange; }
         #star{
             margin-left: 0px;
             margin-top: 40px;
             margin-bottom: 10px;
         }

        #Toggle{
            border-top: 1px solid #e0e0e0;
        }

        #btn_write{
            margin-bottom: 10px;
        }

    </style>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
</head>
<body class="is-preload" style="padding: 200px">

<!-- Header -->
<header id="header" th:include="/main/header::header_body">

</header>

<!-- Wrapper -->
<div class="wrapper">

    <!-- Main -->
    <section class="main left">

        <!-- Banner -->
        <section id="banner">
            <article data-position="bottom right">
                <div class="inner">
                    <img src="/images/bread1.jpeg" alt="">
                </div>
            </article>
            <article data-position="top right">
                <div class="inner">
                    <img src="/images/bread2.png" alt="">
                </div>
            </article>
            <article data-position="right">
                <div class="inner">
                    <img src="/images/bread3.jpeg" alt="">
                </div>
            </article>
            <article data-position="center">
                <div class="inner">
                    <img src="/images/bread4.jpeg" alt="">
                </div>
            </article>
        </section>


        <div class="fields" th:object="${board}">
        <!-- Blurb -->
        <section>
            <h1>타이틀</h1>
                <input name="title" type="text" th:field="*{title}"readonly/>

        </section>

<!--         TAB -->

        <div class="main1">
            <input id="tab1" type="radio" name="tabs" checked> <!--디폴트 메뉴-->
            <label for="tab1">상세 설명</label>


            <input id="tab2" type="radio" name="tabs">
            <label for="tab2">후기</label>


            <section id="content1">
                <div>
                <h4>이런 분들이 들으면 좋아요!</h4>
                    <textarea name="content" rows="6" style="resize:none" th:text="*{content}" readonly></textarea>
                </div>
                <div>
                <h4>가격</h4>
                    <textarea name="content" rows="6" style="resize:none" th:text="*{classprice}" readonly>
                </div>
                <div>
                <h4>날짜 및 시간</h4>
                <input type="text" style="background-color: white; border-color: white">
                </div>
                <div>
                <h4>인원 수</h4>
                <input type="text" style="background-color: white; border-color: white">
                </div>
                <div>
                <h4>위치</h4>
                </div>
                <p style="margin-top:-12px">
                    <em class="link">
                        <a href="javascript:void(0);" onclick="window.open('http://fiy.daum.net/fiy/map/CsGeneral.daum', '_blank', 'width=981, height=650')">
                            혹시 주소 결과가 잘못 나오는 경우에는 여기에 제보해주세요.
                        </a>
                    </em>
                </p>
                <div id="map" style="width:100%;height:350px;"></div>
            </section>

            <section id="content2">
                <div id="replywrite">
                    <div>
                        <p>댓글이 없습니다.</p>
                    </div>
                    <div id="btn_write">
                        <button type="submit" id="btn_toggle">리뷰 쓰기</button>
                    </div>
                </div>

                <div>
                    <div id="Toggle" style="display: none">
                        <div>
                            <span id="userid" style="float:left; margin-top: 1em;" >사용자 아이디</span>
                            <input type="text" name="replier" placeholder="Replier">
                            <span id="date" style="float:right; margin-top: 1em;">날짜</span>
                        </div>

                            <P id="star" > <!-- 부모 -->
                                <a href="#" onclick="return false" value="1">★</a> <!-- 자식들-->
                                <a href="#" onclick="return false" value="2">★</a>
                                <a href="#" onclick="return false" value="3">★</a>
                                <a href="#" onclick="return false" value="4">★</a>
                                <a href="#" onclick="return false" value="5">★</a>
                            </p>

                        <div>
                            <div class="files">
                                <input id="reviewimg" name="reviewimg" type="file">
                            </div>
                        </div>
                        <div><textarea rows="6" name="reply" placeholder="Reply" style="resize: none"></textarea></div>
                        <div>
                            <a href="javascript:void(0)" type="submit" id="save" class="finish" style="float: right">등록</a>
                        </div>
                    </div>
                    <ul class="replies"></ul>
                </div>
                <div class="paging" style="text-align: center"></div>
            </section>

            </div>
        </div>
    </section>

    <!-- Sidebar -->
        <!-- 우측 결제하기 box -->
        <div id="apply">
            <div class="summary">
            <section>
                <h2>장소 및 일정</h2>
                <p>장소 : </p>
                <p>일정 : </p>
                <ul class="actions">
                    <li><a href="/class/classApply" class="button">신청하기</a></li>
                </ul>
            </section>
            </div>
        </div>
</div>

<!-- Footer -->
<footer id="footer" th:include="/main/footer::footer_body"></footer>

<!-- Scripts -->
<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.dropotron.min.js"></script>
<script src="/js/browser.min.js"></script>
<script src="/js/breakpoints.min.js"></script>
<script src="/js/util.js"></script>
<script src="/js/main.js"></script>
<script src="/js/classreply.js"></script>
<script th:replace="/main/header::header_js"></script>
<script>
    $('#star a').click(function(){
        $(this).parent().children("a").removeClass("on");
        $(this).addClass("on").prevAll("a").addClass("on");
        console.log($(this).attr("value")); });
</script>
<!--<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=dbbd6cafd6a9270f3ff84ad1d9873ab9"></script>-->
<script>
    $(function (){
        $("#btn_toggle").click(function (){
            $("#Toggle").toggle();
        });
    });
</script>
<!--<script>-->
<!--    var mapContainer = document.getElementById('map'), // 지도를 표시할 div-->
<!--        mapOption = {-->
<!--            center: new kakao.maps.LatLng(37.500151, 127.035613), // 지도의 중심좌표-->
<!--            level: 3 // 지도의 확대 레벨-->
<!--        };-->

<!--    // 지도를 생성합니다-->
<!--    var map = new kakao.maps.Map(mapContainer, mapOption);-->

<!--    // 주소-좌표 변환 객체를 생성합니다-->
<!--    var geocoder = new kakao.maps.services.Geocoder();-->

<!--    // 주소로 좌표를 검색합니다-->
<!--    geocoder.addressSearch('서울 강남구 역삼동 736-6', function(result, status) {-->

<!--        // 정상적으로 검색이 완료됐으면-->
<!--        if (status === kakao.maps.services.Status.OK) {-->

<!--            var coords = new kakao.maps.LatLng(result[0].y, result[0].x);-->

<!--            // 결과값으로 받은 위치를 마커로 표시합니다-->
<!--            var marker = new kakao.maps.Marker({-->
<!--                map: map,-->
<!--                position: coords-->
<!--            });-->

<!--            // 인포윈도우로 장소에 대한 설명을 표시합니다-->
<!--            var infowindow = new kakao.maps.InfoWindow({-->
<!--                content: '<div style="width:150px;text-align:center;padding:6px 0;">우리회사</div>'-->
<!--            });-->
<!--            infowindow.open(map, marker);-->

<!--            // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다-->
<!--            map.setCenter(coords);-->
<!--        }-->
<!--    });-->
<!--</script>-->
<script th:inline="javascript">
    let bno = 1;
    let replyUL = $("ul.replies");
    let pageNum = 1;

    // $(".cancel").on("click", function(e){
    //     e.preventDefault();
    //     $("input[name='replier']").val("");
    //     $("textarea[name='reply']").val("");
    //     $(".register-form").hide();
    //     $(".register").show();
    // })

    $(".finish").on("click", function(e){
        e.preventDefault();
        let reply = $("textarea[name='reply']").val();

        console.log("들어옴ㅁㅁㅁㅁㅁ");
        // if(!userId || !content){return;}

        classReplyService.add({bno:bno, reply:reply},
            function(result){
                alert(result);
                $("textarea[name='reply']").val("");
                $(".register-form").hide();
                $(".register").show();
                showList(pageNum);
            }
        )

    });

    // $("a#goList").on("click", function(){
    //     location.href = "/class/list" + paging;
    // });

    function showReplyPage(replyCnt){
        let endNum = Math.ceil(pageNum / 10.0) * 10;
        let startNum = endNum - 9;
        let realEnd = Math.ceil(replyCnt / 10.0);
        let divTag = $(".paging");
        let str = "";

        if(endNum > realEnd){
            endNum = realEnd;
        }

        let prev = startNum != 1;
        let next = endNum * 10 < replyCnt;

        //917px 까지
        if(matchMedia("screen and (max-width:918px)").matches){
            if(pageNum > 1){
                str += "<a class='changePage' href='" + (pageNum - 1) + "'><code>&lt;</code></a>"
            }
            str += "<code>" + pageNum + "</code>";
            if(pageNum < realEnd){
                str += "<a class='changePage' href='" + (pageNum + 1) + "'><code>&gt;</code></a>"
            }

        }else{//918px 이상
            if(prev){
                str += "<a class='changePage' href='" + (startNum - 1) + "'><code>&lt;</code></a>"
            }
            for(let i=startNum; i<=endNum; i++){
                if(i == pageNum){
                    str += "<code>" + i + "</code>";
                    continue;
                }
                str += "<a class='changePage' href='" + i + "'><code>" + i + "</code></a>";
            }
            if(next){
                str += "<a class='changePage' href='" + (endNum + 1) + "'><code>&gt;</code></a>"
            }
        }
        divTag.html(str);
    }

    //이벤트 위임
    //작성된 HTML에는 이벤트 처리가 가능하지만,
    //DOM에서 새롭게 추가되는 HTML에는 이벤트가 반영되지 않는다.
    //따라서 미리 작성해놓은 HTML에 이벤트를 반영한 후,
    //해당 자식 태그를 선택하여 이벤트 위임을 진행해야 한다.
    $("div.paging").on("click", "a.changePage", function(e){
        e.preventDefault();
        pageNum = parseInt($(this).attr("href"));
        showList(pageNum);
    });

    function showList(page){
        classReplyService.getList({bno:bno, page:page || 1},
            function(replyCnt, list){
                if(list == null || list.length == 0){
                    replyUL.html("댓글이 없습니다.");
                    return;
                }
                let str = "";
                for(let i=0, len=list.length; i<len; i++){
                    str += "<li style='display: block' data-rno='" + list[i].rno + "'>"
                    str += "<strong>" + list[i].replier + "</strong>"
                    str += "<div>"
                    str += "<p class='reply" + list[i].rno +"'>" + list[i].reply + "</p>"
                    str += "<p><strong class='date'>" + classReplyService.displayTime(list[i].replyDate);

                    str += "</strong></p></div>"
                    str += "</li>"
                    str += "<div class='line'></div>"
                }
                replyUL.html(str);
                showReplyPage(replyCnt);
            }
        );
    }

    // let check = false;

    // $(".replies").on("click", "a.modify", function(e){
    //     e.preventDefault();
    //     if(check){alert("수정 중인 댓글이 있습니다."); return;}
    //     let rnoValue = $(this).attr("href");
    //     $("p.reply" + rnoValue).html("<textarea class='" + rnoValue + "'>" + $("p.reply" + rnoValue).text() + "</textarea>")
    //     $(this).hide();
    //
    //     let arFinish = $(".finish");
    //     for(let i=0; i<arFinish.length; i++){
    //         if($(arFinish[i]).attr("href") == rnoValue){
    //             $(arFinish[i]).show();
    //             check = true;
    //             break;
    //         }
    //     }
    // });

    $(".replies").on("click", "a.finish", function(e){
        e.preventDefault();

        let rnoValue = $(this).attr("href");
        let newReply = $("." + rnoValue).val();

        if(newReply == ""){return;}

        classReplyService.update({rno:rnoValue, reply:newReply},
            function(result){
                alert(result);
                check = false;
                showList(pageNum);
            }
        )
    })
</script>
</body>
</html>